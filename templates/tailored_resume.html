<div class="actions">
    <button id="copyResumeBtn" class="btn btn-secondary">
        <i class="fas fa-copy"></i> Copy to Clipboard
    </button>
    <button id="download-pdf" class="btn btn-primary">
        <i class="fas fa-file-pdf"></i> Download PDF
    </button>
    <button id="back-button" class="btn btn-secondary">
        <i class="fas fa-arrow-left"></i> Back
    </button>
</div>

<div class="resume-container">
    <div id="resume-preview">
        <!-- Resume content goes here -->
    </div>
</div>

<script>
    // Store resume data in JavaScript variable
    const resumeData = {{ resume|tojson }};
    
    // Handle PDF download
    document.getElementById('download-pdf').addEventListener('click', async function() {
        try {
            const downloadButton = this;
            
            // Disable the button and show loading state
            downloadButton.disabled = true;
            downloadButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Generating PDF...';
            
            // Send the resume data to the backend
            const response = await fetch('/download_pdf', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(resumeData)
            });
            
            if (!response.ok) {
                throw new Error('Failed to generate PDF');
            }
            
            // Convert the response to a blob
            const blob = await response.blob();
            
            // Create a URL for the blob
            const url = window.URL.createObjectURL(blob);
            
            // Create a temporary anchor element to trigger download
            const a = document.createElement('a');
            a.style.display = 'none';
            a.href = url;
            
            // Set the file name
            let filename = resumeData.name ? 
                `${resumeData.name.replace(/\s+/g, '_')}_Resume.pdf` : 
                'Tailored_Resume.pdf';
            
            a.download = filename;
            
            // Append to the document
            document.body.appendChild(a);
            
            // Trigger download
            a.click();
            
            // Clean up
            window.URL.revokeObjectURL(url);
            document.body.removeChild(a);
            
            // Reset button state
            downloadButton.disabled = false;
            downloadButton.innerHTML = '<i class="fas fa-file-pdf"></i> Download PDF';
            
        } catch (error) {
            console.error('Error downloading PDF:', error);
            alert('Failed to generate PDF. Please try again.');
            
            // Reset button state
            downloadButton.disabled = false;
            downloadButton.innerHTML = '<i class="fas fa-file-pdf"></i> Download PDF';
        }
    });
    
    // Back button functionality
    document.getElementById('back-button').addEventListener('click', function() {
        window.history.back();
    });
</script> 