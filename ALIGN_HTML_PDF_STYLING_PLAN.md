# Implementation Plan: Align HTML & PDF Styling from a Single Source

**Goal**
Make the browser preview (`preview.css`) and the generated PDF (`print.css`) render the résumé with identical YC-Eddie styling, driven from one canonical set of design-tokens.

---
## 1. Consolidate the Styling Source of Truth

### 1.1 Design-tokens
- Ensure `design_tokens.json` includes every visual constant: fonts, colors, margins, paddings, bullet glyph, line-height, border widths, etc.
- Use generic, self-documenting keys. Example:
  ```json
  {
    "fontFamilyBody": "Inter, Calibri, sans-serif",
    "fontSizeBody": "11pt",
    "primaryColor": "#0D2B7E",
    "pagePadding": "0 0.5in",
    "pageMarginCM": "1 1.5",
    "sectionHeaderBorder": "1px solid #0D2B7E"
  }
  ```

### 1.2 Token → SCSS Pipeline
- Keep or add `tools/generate_tokens_css.py` that reads `design_tokens.json` and writes variables into `static/scss/_tokens.scss`:
  ```scss
  $font-family-body: "Inter, Calibri, sans-serif";
  $primary-color: #0D2B7E;
  $page-padding: 0 0.5in;
  ```
- Hook this script into a build step (e.g., `npm run build-css` or Makefile).

---
## 2. Restructure the SCSS

**Directory Layout:**
```
static/scss/
  _tokens.scss      // generated by tokens script
  _base.scss        // CSS resets, typography, utilities
  _resume.scss      // Core YC-Eddie resume styles (section headers, bullets, spacing)
  preview.scss      // Imports: _tokens + _base + _resume → adds screen-only chrome (shadows, background)
  print.scss        // Imports: _tokens + _base + _resume → adds print-only rules (@page, remove shadows)
```

- **_resume.scss**: Defines the actual layout, fonts, colors, lists, headers—no media queries.
- **preview.scss**: Wraps resume in a "paper" UI with background, box-shadow, centered flex container.
- **print.scss**: Contains:
  ```scss
  @page {
    size: A4;
    margin: #{map-get($tokens, pageMarginCM)}cm;
  }
  ```
  plus removal of screen-only effects.

**Output:**
```
static/css/preview.css
static/css/print.css
```

---
## 3. Update StyleManager (Python)
```python
class StyleManager:
    @staticmethod
    def preview_css_path() -> str:
        return str(Path(__file__).parent / 'static/css/preview.css')

    @staticmethod
    def print_css_path() -> str:
        return str(Path(__file__).parent / 'static/css/print.css')

    @staticmethod
    def tokens() -> dict:
        return load_tokens()
```
- Exposes token data and absolute CSS paths for both outputs.

---
## 4. Clean Up HTML Generator
1. Add a `for_screen: bool` flag to `generate_preview_from_llm_responses`.
2. When `for_screen=True`, inject:
   ```html
   <link rel="stylesheet" href="/static/css/preview.css?v={cache_bust}">
   ```
3. When generating HTML for PDF export, call with `for_screen=False` so no `<link>` tags remain.

---
## 5. Adjust PDF Exporter
1. In `PDFExporter.html_to_pdf`, load **both** stylesheets:
   ```python
   stylesheets = [
     CSS(filename=StyleManager.print_css_path(), font_config=self.font_config),
     CSS(filename=StyleManager.preview_css_path(), font_config=self.font_config)
   ]
   ```
   - Ensures core resume rules (from `_resume.scss`) apply, and print overrides kick in.
2. Remove any stray `<link href="/static/css/preview.css">` from the HTML string before passing to WeasyPrint.

---
## 6. Build / CI Workflow
- Create an NPM or Makefile target `build-css` that runs:
  1. `python tools/generate_tokens_css.py`
  2. `sass static/scss/preview.scss static/css/preview.css`
  3. `sass static/scss/print.scss static/css/print.css`
- Add a CI step to run `build-css` then `git diff --exit-code static/css/*`. Fail if compiled output diverges.

---
## 7. Regression Tests
1. **Unit Test**: Verify `preview.css` and `print.css` contain key selectors (e.g., `.section-header`) and share identical variable definitions.
2. **Visual E2E**: Use Playwright + `pdf2image`:
   - Render HTML preview → screenshot.
   - Generate PDF → render first page → image.
   - Compare images with perceptual diff (SSIM ≥ 0.95).

---
## 8. Migration Steps (No Downtime)
1. Create a feature branch for the SCSS restructure.
2. Update Python code (`StyleManager`, emitters, exporter) to reference new CSS.
3. Run build script; correct any selector drift.
4. QA: preview and PDF tests on multiple resumes (DOCX & PDF).
5. Merge and deploy.

---
## 9. What Won't Break
- **Class names** remain unchanged so parsing logic and LLM prompts are unaffected.
- **Flask static** route continues serving CSS files.
- **PDF filenames** and endpoints remain the same.

---
## 10. Future-Proofing
- To tweak any design detail (e.g., margins, brand color), edit **only** `design_tokens.json` (or `_resume.scss` for structural changes).
- Support additional themes (dark mode) by compiling new variants (e.g., `preview-dark.css`) that still import `_resume.scss`.

---
## 11. Deliverables
1. Refactored SCSS files + `build-css` script.  
2. Updated `style_manager.py`, `html_generator.py`, and `pdf_exporter.py`.  
3. CI job to guard compiled CSS.  
4. Documentation (`ALIGN_HTML_PDF_STYLING_PLAN.md`) describing token→SCSS→outputs flow. 