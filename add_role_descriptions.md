# Feature Implementation Plan: Add Role Descriptions to Experience Section

**Goal:** Enhance the tailored resume by adding a concise role description below the job title in the Experience section. This description will be tailored if provided in the original resume or generated by the LLM if missing, based on the job title and bullet points.

**Branch:** `add_role_descriptions`

---

## Phase 1: Data Structure & Parsing Update

**Objective:** Modify the data structure to accommodate the role description and update the parsing logic to identify existing descriptions.

**Tasks:**

1.  **Modify JSON Schema:** Define the updated structure for entries in the `experience` list within the resume JSON. Each job dictionary should now include an optional `role_description: str | None` field.
    *   **File(s) Affected:** Documentation (if schema exists), potentially implied structure in parsers/handlers.
2.  **Update LLM Resume Parser:** Modify the prompt and potentially the post-processing logic in `llm_resume_parser.py` to *attempt* to identify text between the job title/company/date line and the bullet points as the `role_description`. Populate the new field if found; otherwise, set it to `null` or `""`.
    *   **File(s) Affected:** `llm_resume_parser.py`
3.  **Update Fallback Parser (if applicable):** If a non-LLM parser (`resume_processor.py`?) is used as a fallback, update its logic to attempt the same identification.
    *   **File(s) Affected:** `resume_processor.py` (or relevant parsing module)
4.  **Testing:** Test the updated parsing logic with resumes containing and lacking role descriptions to ensure the `role_description` field is populated correctly.

**Estimated Time:** 1-2 days

---

## Phase 2: LLM Tailoring Integration

**Objective:** Update the LLM tailoring process to handle the new `role_description` field, either tailoring existing content or generating new content.

**Tasks:**

1.  **Update Tailoring Prompt:** Modify the prompt sent to the tailoring LLM (`claude_integration.py` or equivalent).
    *   Instruct the LLM to check the `role_description` field for each job in the `experience` section.
    *   If `role_description` has content, tailor it along with the title and bullet points.
    *   If `role_description` is empty/null, generate a concise (1-2 sentences) description based on the `position` (title) and the *original* `achievements` (bullet points). Place the generated text in the `role_description` field of the output JSON.
    *   Specify output format requirements clearly.
    *   **File(s) Affected:** `claude_integration.py`, potentially `tailoring_handler.py` (for prompt construction).
2.  **Update Response Handling:** Ensure the code in `tailoring_handler.py` correctly extracts the (potentially new) `role_description` from the LLM's response and saves it to the tailored JSON file (e.g., `static/uploads/temp_session_data/{request_id}_experience_tailored.json`).
    *   **File(s) Affected:** `tailoring_handler.py`
3.  **Testing:** Test the tailoring process with various inputs (with/without existing descriptions) and verify the LLM output and the resulting tailored JSON.

**Estimated Time:** 2-3 days

---

## Phase 3: HTML Generation & Styling

**Objective:** Render the role description in the HTML preview with appropriate styling.

**Tasks:**

1.  **Update HTML Generation:** Modify `html_generator.py` (specifically the logic that processes the experience section, possibly involving `format_job_entry`) to include the `role_description`. Add a `div` or `p` tag with class `role-description-text` below the title/company/date line and before the bullet points list (`ul`). Only render this element if `role_description` has content.
    *   **File(s) Affected:** `html_generator.py`
2.  **Update SCSS:** Add styling rules for the `.role-description-text` class in `static/scss/_resume.scss`. Define appropriate margins, font size, font style (e.g., `font-style: italic;`), etc.
    *   **File(s) Affected:** `static/scss/_resume.scss`
3.  **Compile SCSS:** Run the build command (e.g., `npm run build-scss` or `sass static/scss:static/css`) to update `static/css/preview.css` and `static/css/print.css`.
    *   **File(s) Affected:** `static/css/preview.css`, `static/css/print.css`
4.  **Testing:** Verify the HTML preview renders correctly for jobs with and without descriptions. Check styling and positioning.

**Estimated Time:** 1 day

---

## Phase 4: PDF Generation Update

**Objective:** Ensure the role description renders correctly and consistently in the PDF output.

**Tasks:**

1.  **Update PDF Template:** Modify the Jinja template `templates/resume_pdf.html`. Add logic similar to Phase 3.1 to render the `role_description` within the experience loop, using the same HTML structure and class (`role-description-text`).
    *   **File(s) Affected:** `templates/resume_pdf.html`
2.  **Verify PDF Styling:** Since `pdf_exporter.py` uses WeasyPrint with `print.css`, the styles added in Phase 3.2 *should* apply. Generate PDFs and verify the rendering and styling of the `role_description`. Adjust styles in `print.scss` (and recompile) if necessary for PDF-specific tweaks.
    *   **File(s) Affected:** `static/scss/print.scss` (if needed), `static/css/print.css`
3.  **Testing:** Generate PDFs for various test cases and compare them against the HTML preview for consistency.

**Estimated Time:** 1 day

---

## Phase 5: End-to-End Testing & Refinement

**Objective:** Conduct thorough testing of the entire workflow and refine prompts or styling as needed.

**Tasks:**

1.  **Comprehensive Testing:** Test the full workflow with diverse resume inputs (DOCX, PDF, with/without descriptions, complex/simple job entries) and job descriptions.
2.  **Prompt Tuning:** Evaluate the quality of generated descriptions. Refine the LLM prompt in Phase 2 if necessary for better conciseness, relevance, or tone.
3.  **Style Adjustments:** Make final tweaks to SCSS based on visual review of HTML and PDF outputs.
4.  **Code Review & Cleanup:** Review all changes, add comments where necessary, and remove any debug code.
5.  **Documentation Update:** Update `README.md` or other relevant documentation (`TASK.md`?) to reflect the new feature.

**Estimated Time:** 1-2 days

---

**Total Estimated Time:** 6-9 days

---

## Learnings and Fixes

### Experience Section Rendering Issue

**Issue:** The "User Resume Parsed" section in the UI did not display the Experience details correctly after modifying the data structure to include `role_description`.

**Cause:** The backend was generating HTML previews assuming `experience` was a string, not a list of job objects.

**Fix:** Updated the HTML generation logic in `upload_handler.py` to correctly iterate over the `experience` list and format each job entry with position, company/location/dates, role description, and achievements.

### Application Workflow for Resume Parsing

1. **Resume Upload:**
   - User uploads a resume (DOCX/PDF) via the web interface.
   - The file is saved to the server, and the `/upload-resume` endpoint is triggered.

2. **Parsing Process:**
   - **LLM Parsing:**
     - The resume is parsed using an LLM (e.g., OpenAI or Claude) if available.
     - The parsed data is structured into sections: contact, summary, experience, education, skills, projects, and additional information.
     - The `experience` section is now a list of job objects, each containing `position`, `company`, `location`, `dates`, `role_description`, and `achievements`.
   - **Fallback Parsing:**
     - If LLM parsing fails, traditional parsing methods are used.

3. **HTML Preview Generation:**
   - The backend generates an HTML preview of the parsed resume.
   - For the `experience` section, it iterates over the list of job objects and formats them into HTML.

4. **Frontend Display:**
   - The generated HTML is sent to the frontend and displayed in the "User Resume Parsed" section.

### Future Changes and Additions

- **Adding New Fields:**
  - When adding new fields to the resume structure, ensure both the backend parsing logic and HTML generation are updated to handle the new data.
  - Update the frontend JavaScript if the new data requires dynamic interaction or display changes.

- **Testing:**
  - Thoroughly test with various resume formats to ensure new fields are correctly parsed and displayed.

- **Documentation:**
  - Document any changes to the data structure and display logic to maintain clarity for future development.

--- 