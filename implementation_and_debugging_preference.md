# AI Debug & Build Playbook

### Purpose

A living log and template for hypothesis‑driven debugging, implementation, and testing when collaborating with an AI assistant on your web‑app work.

---

## How to use this document

1. **Copy the template below** into a fresh section each time you raise a new issue or feature request.
2. Fill in the *Observed symptom* (or *Desired feature*) field.
3. Ask the AI to populate *Hypotheses*, a detailed *Implementation plan*, and an *Automated test script*.
4. Run (or let the AI run) the test; paste outcomes in *Results & notes*.
5. Iterate by updating the same entry or creating a linked follow‑up entry.
6. Avoid commit and push changes to Github until the human test and validated the changes 

---

## Entry template

```markdown
### [YYYY‑MM‑DD] Issue / Feature: <concise title>

**Attempt number**
1

**Observed symptom / Desired behaviour**
<brief description or error snippet>

**Hypotheses (root‑cause or design assumptions)**
1.
2.
3.

**Implementation plan**
- [ ] Step 1
- [ ] Step 2
- [ ] Step 3

**Automated test script (AI‑generated by default)**
```bash
# e.g. pytest test_html_render.py
````

## **Results & notes**

*

**Lessons & next steps**

* What did we learn from this attempt?
* What will we change for the next attempt?

```bash
# e.g. pytest test_html_render.py
```

## **Results & notes**

*

```

---

## Log of issues & experiments

### [2025-05-08] Issue: Resume Content Alignment Inconsistencies

**Attempt number**
1

**Observed symptom / Desired behaviour**
Resume content shows inconsistent alignment in the HTML/PDF preview:
1. Role descriptions aligned with company names instead of with bullet points
2. Section header boxes not aligned with section content
3. Bullet points for achievements not consistently aligned with other content

**Hypotheses (root-cause or design assumptions)**
1. HTML structure issues: Role descriptions might be placed outside the proper containing element
2. CSS margin/padding inconsistencies: Different margin and padding values applied inconsistently
3. Duplicate CSS rules: Overlapping and conflicting rules in the CSS files
4. Container relationship issues: Parent-child relationships not properly structured for consistent alignment

**Implementation plan**
- [x] Analyze HTML generation in the `format_job_entry` function to check placement of role descriptions
- [x] Check section box styling and its relationship to content alignment in _resume.scss
- [x] Review all margin/padding settings for consistency and use of design tokens
- [x] Look for duplicate or conflicting CSS rules that might affect alignment
- [x] Implement fixes for each issue and test in both HTML/PDF and DOCX formats

**Automated test script**
```bash
# Regenerate tokens after changes
python tools/generate_tokens.py

# Start the development server
python app.py

# Access http://localhost:5000 in browser
# Test the HTML preview, PDF download, and DOCX download 
# Compare alignment across all formats
```

## **Results & notes**

* Issue 1 (Role descriptions): Fixed by moving the role description inside the `job-content` div in the `format_job_entry` function of `html_generator.py`
* Issue 2 (Section header alignment): Fixed by adding `margin-left: $content-left-margin` to the `.section-box` class
* Issue 3 (Bullet point alignment): Fixed by adding consistent left margin to job containers and removing duplicate styling rules

The application now displays proper alignment in both HTML/PDF and DOCX outputs:
- Section headers properly aligned with content
- Role descriptions properly indented with bullet points
- Consistent bullet point indentation

**Lessons & next steps**

* HTML/CSS alignment requires careful attention to container relationships
* Using consistent design tokens for margins and padding helps maintain visual consistency
* Duplicate CSS rules can cause hard-to-diagnose styling issues
* Different output formats (HTML vs DOCX) require different technical approaches but can achieve the same visual result

Next steps:
1. Consider implementing visual regression testing for alignment issues
2. Create a visual style guide for alignment patterns
3. Review any remaining inconsistencies in section spacing

### [2025-05-11] Issue: DOCX Section Header Box Alignment

**Attempt number**
4

**Observed symptom / Desired behaviour**
Section header boxes in the DOCX output are not properly aligned with the content text:
- Section header boxes appear to have a different left indent than company/position text
- Role descriptions and bullet points have their own alignment, creating a visually inconsistent document
- Despite multiple attempts to fix with a global indent token, misalignment persists
- Need all elements (section headers, company info, positions, role descriptions, bullets) to align consistently

**Hypotheses (root-cause or design assumptions)**
1. **DOCX Formatting Layer Conflicts**: Multiple layers of formatting (styles, direct paragraph formatting, XML manipulation) are competing and overriding each other
2. **Inconsistent Formatting Approaches**: Some elements use direct paragraph properties, others use XML manipulation, creating inconsistencies 
3. **DOCX Numbering System**: Bullet points use a separate numbering definition system with its own indentation rules, not inheriting from paragraph styles
4. **Measurement Unit Conversion**: Inconsistent conversion between cm, points, and twips causes slight misalignments
5. **Box Border Consideration**: The section header box border width might not be properly accounted for in alignment calculations

**Implementation plan**
- [ ] Create a debug mechanism to examine the true indentation values in the generated DOCX:
  - [ ] Create helper function to output debugging info for all paragraph indents
  - [ ] Generate a sample DOCX and extract its XML to analyze formatting
  
- [ ] Standardize on a single formatting approach across all elements:
  - [ ] Choose either style-based or direct formatting
  - [ ] Implement all indentation consistently through the chosen approach
  - [ ] Remove any competing formatting methods

- [ ] Focus on section header box implementation:
  - [ ] Ensure section header uses same formatting method as content paragraphs
  - [ ] Account for border width in left indent calculations
  - [ ] Use style-level formatting as primary approach

- [ ] Fix bullet point alignment:
  - [ ] Review and update numbering definition system
  - [ ] Adjust bullet point indentation to be consistent with other elements
  - [ ] Ensure hanging indent is properly applied

- [ ] Create verification tests:
  - [ ] Generate and examine multiple DOCX outputs with different content types
  - [ ] Verify consistent alignment in all cases

**Automated test script**
```bash
# Regenerate tokens after changes
python tools/generate_tokens.py

# Create and save debugging output for DOCX generation
python -c "
import os
from docx import Document
from docx.shared import Cm
from utils.docx_builder import build_docx
from io import BytesIO

# Sample test case
request_id = os.listdir('static/uploads/temp_session_data')[0].split('_')[0]
temp_dir = 'static/uploads/temp_session_data'

# Build DOCX
docx_bytes = build_docx(request_id, temp_dir)

# Save for manual inspection
with open('debug_output.docx', 'wb') as f:
    f.write(docx_bytes.getvalue())

print('Saved debug DOCX for manual inspection')
"

# Start the app to test changes
python app.py
```

## **Results & notes**

*

**Lessons & next steps**

* What we learn will determine our next approach
* If we need to coordinate with HTML/PDF output alignment, we should ensure our tokenization process converts CSS units to DOCX units consistently
* The ultimate goal is a single styling system that works across all output formats consistently
